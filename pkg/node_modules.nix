{ stdenvNoCC, nodejs }:

stdenvNoCC.mkDerivation rec {
  name = "node_modules";
  package = ../assets/package.json;
  lockfile = ../assets/package-lock.json;
  # hash = "sha256:${pkgs.lib.fakeSha256}";
  hash = "sha256:0rjccl649sy7k4gx5ipk8x5r95hak6y30lvlbvalahbaa3fvx7pk";
  buildInputs = [
    nodejs
  ];
  builder = builtins.toFile "builder.sh" ''
    source $stdenv/setup

    install $package package.json
    install $lockfile package-lock.json

    HOME=.
    npm ci --no-progress --no-fund --no-audit --no-update-notifier --loglevel error

    mkdir $out
    cp -r node_modules/. $out
  '';

  outputHashMode = "recursive";
  outputHash = hash;

  impureEnvVars = stdenvNoCC.lib.fetchers.proxyImpureEnvVars;
}
